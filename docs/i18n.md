# Internationalization (i18n) in Comfy Registry

This document explains how internationalization is implemented in the Comfy Registry web application.

## Technologies Used

- react-i18next: Core i18n functionality
- i18next: The underlying i18n framework
- i18next-browser-languagedetector: For automatic language detection
- i18next-http-backend: For loading translations

## Supported Languages

Currently, the application supports the following languages:

- English (en) - Default
- Chinese (zh)
- Japanese (ja)

## How to Use Translations

### Using the `useNextTranslation` Hook

```tsx
import { useNextTranslation } from 'src/hooks/i18n'

const MyComponent = () => {
    const { t } = useNextTranslation()

    return <p>{t('Hello World')}</p>
}
```

### With Variables

```tsx
const { t } = useNextTranslation()

// In your JSX
<p>{t("Welcome, {{username}}", { username: user.name })}</p>
```

## Adding New Translations

1. Create translation keys in the `/public/locales/{language}/common.json` files
2. Use the same English text as the key in your components
3. Add translations for each supported language

## Adding a New Language

1. Create a new folder in `/public/locales/{new-language-code}/`
2. Copy the `common.json` file from the `en` folder
3. Translate all the values in the new `common.json` file
4. Add the language code to the `locales` array in `next-i18next.config.js`

## Language Switcher

A language switcher component is available at `components/common/LanguageSwitcher.tsx`. This component allows users to switch between the available languages.

### Language Persistence

The application stores the user's language preference in localStorage and cookies with the key `comfy-registry-language-preference`. This ensures that:

1. The user's language preference persists across visits
2. The preferred language is automatically applied when the user returns to the site
3. The browser's language is only used for the initial visit if no preference is stored

### Server-Side Language Detection

The application also implements server-side language detection through Next.js middleware. This provides the following benefits:

1. **SEO-friendly**: Search engines can index content in the correct language
2. **No Flash of Wrong Language**: Users see content in their preferred language immediately without any flicker
3. **Consistent Experience**: Language detection works even if JavaScript is disabled

The server-side detection works by:

1. Checking for existing language preference in cookies
2. Reading the `Accept-Language` HTTP header if no cookie is present
3. Setting a cookie with the detected language
4. Passing the language preference to the client-side i18n setup

## Translation Files Structure

```
/public/locales/
  /en/
    common.json
  /zh/
    common.json
  /ja/
    common.json
```

## Best Practices

1. Always use the `t()` function for any text visible to users
2. Use the original English text as the translation key
3. Keep translation keys simple and meaningful
4. Use variables for dynamic content
5. Test the UI in all supported languages
