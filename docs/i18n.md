# Internationalization (i18n) in Comfy Registry

This document explains how internationalization is implemented in the Comfy Registry web application.

## i18n Implementation Progress

### Components Status
- [x] PublisherDetail.tsx - ✅ Completed
- [x] NodeVDrawer.tsx - ✅ Completed
- [x] Registry.tsx - ✅ Completed
- [x] FilterRegistry.tsx - ✅ Completed
- [x] RegistryCard.tsx - ✅ Completed
- [x] MailtoNodeVersionModal.tsx - ✅ Completed
- [x] CodeBlock.tsx - ✅ Completed
- [x] PublisherStatusBadge.tsx - ✅ Completed
- [x] CreatePublisherForm.tsx - ✅ Completed
- [x] PublisherNodes.tsx - ✅ Completed
- [x] ClearableLabel.tsx - ✅ Completed (no translatable text)
- [x] EditPublisherModal.tsx - ✅ Completed
- [x] EditSecretKeyModal.tsx - ✅ Completed
- [x] layout.tsx - ✅ Completed
- [x] PublisherListNodes.tsx - ✅ Completed
- [x] NodeDetails.tsx - ✅ Completed
- [x] NodesCard.tsx - ✅ Completed
- [x] NodeEditModal.tsx - ✅ Completed
- [x] NodeLogoModal.tsx - ✅ Completed
- [x] UnclaimedNodeCard.tsx - ✅ Completed
- [x] SearchRankingEditModal.tsx - ✅ Completed
- [x] PreemptedComfyNodeNamesEditModal.tsx - ✅ Completed
- [x] NodeDeleteModal.tsx - ✅ Completed
- [x] AdminCreateNodeFormModal.tsx - ✅ Completed (already had i18n)
- [x] NodeVersionStatusBadge.tsx - ✅ Completed
- [x] NodeClaimModal.tsx - ✅ Completed
- [x] NodeVersionDeleteModal.tsx - ✅ Completed
- [x] NodeStatusBadge.tsx - ✅ Completed
- [x] CustomSearchPagination.tsx - ✅ Completed
- [x] GenericHeader.tsx - ✅ Completed (receives props)
- [x] LanguageSwitcher.tsx - ✅ Already implemented
- [x] DeveloperRegister.tsx - ✅ Completed (no translatable text)
- [x] DrCard.tsx - ✅ Completed
- [x] DrHeader.tsx - ✅ Completed
- [x] Header.tsx - ✅ Completed
- [x] ProfileDropdown.tsx - ✅ Completed
- [x] Container.tsx - ✅ Completed (no translatable text)
- [x] CustomPagination.tsx - ✅ Completed (no translatable text)
- [x] Autocomplete.tsx - ✅ Completed (no translatable text)
- [x] EmptyQueryBoundary.tsx - ✅ Completed (no translatable text)
- [x] Search/index.tsx - ✅ Completed (export file only)
- [x] PublisherId.tsx - ✅ Completed
- [x] SearchHit.tsx - ✅ Completed
- [x] AuthUI.tsx - ✅ Completed
- [x] Logout.tsx - ✅ Completed
- [x] CopyAccessKeyModal.tsx - ✅ Completed
- [x] CreateSecretKeyModal.tsx - ✅ Completed
- [x] PersonalAccessTokenTable.tsx - ✅ Completed

### Pages Status
- [ ] _app.tsx
- [ ] index.tsx
- [ ] nodes.tsx
- [ ] admin/add-unclaimed-node.tsx
- [ ] admin/claim-nodes.tsx
- [ ] admin/index.tsx
- [ ] admin/nodeversions.tsx
- [ ] auth/* pages
- [ ] nodes/* pages
- [ ] publishers/* pages

### Translation Keys Needed
Common translation keys that should be added to locale files:

#### General Actions
- "Edit details"
- "Back to your nodes" 
- "Delete Version"
- "Download Version {{version}}"
- "Updates"
- "Deprecate version"
- "Released"
- "Previous"
- "Next"
- "More"
- "Copy"
- "Cancel"
- "Save Changes"
- "Create"
- "Done"
- "Update"
- "Add"
- "Browse File"
- "Upload Logo"
- "Click to upload"
- "or drag and drop"

#### File Upload
- "SVG, PNG, JPG or GIF (MAX. 800x400px)"

#### Search & Ranking
- "Edit Search Ranking"
- "Search Ranking"
- "Search Ranking: integer from 1 to 10. Lower number means higher search ranking, all else equal."
- "Search ranking updated successfully"
- "Failed to update search ranking"
- "Publisher ID is required to update search ranking"

#### Preempted Node Names
- "Edit Preempted Comfy Node Names"
- "Current Preempted Comfy Node Names"
- "Preempted Comfy Node Names: List of names that should be treated as the same comfy-node. This helps maintain consistent search results across differently named nodes."
- "No preempted comfy node names added yet"
- "Add new name"
- "This name is already in the list"
- "Preempted comfy node names updated successfully"
- "Failed to update preempted comfy node names"
- "Publisher ID is required to update preempted comfy node names"
- "Add"
- "View Nodes"
- "Search"
- "Publishers"
- "Unclaimed"

#### Status & Badges
- "Live"
- "Banned"
- "Pending Security Review"
- "Rejected"

#### Forms & Modals
- "Username"
- "Display Name"
- "Description"
- "Name"
- "Optional"
- "Create a new secret key"
- "Edit secret key"
- "Save your key"
- "E.g. janedoe55"
- "E.g. Jane Doe"
- "Created"
- "MEMBERS"

#### Interface Elements
- "ComfyUI Registry"
- "Discover and install ComfyUI custom nodes."
- "Installs"
- "API Keys"
- "Secret Key"
- "Search by nodes or publisher"
- "Install Comfy CLI with: npm install -g comfy-cli"
- "Logging out..."

#### Error Messages
- "Version not found"
- "Cannot Update" 
- "Could not update version. Please try again."
- "Failed to create secret key"
- "Cannot delete node."
- "Failed to delete node"
- "Failed to update publisher"
- "Could not create publisher. Please try again."

#### Success Messages
- "Version updated successfully"
- "Secret key created"
- "Node deleted successfully"
- "Publisher updated successfully"
- "Copied!"

#### Descriptions
- "Users will see a warning prompting them to use another version."
- "Please save this secret key somewhere safe and accessible. If you lose this secret key, you'll need to generate a new one. It can only be copied once."

## Technologies Used

- react-i18next: Core i18n functionality
- i18next: The underlying i18n framework
- i18next-browser-languagedetector: For automatic language detection
- i18next-http-backend: For loading translations

## Supported Languages

Currently, the application supports the following languages:

- English (en) - Default
- Chinese (zh)
- Japanese (ja)

## How to Use Translations

### Using the `useNextTranslation` Hook

```tsx
import { useNextTranslation } from 'src/hooks/i18n'

const MyComponent = () => {
    const { t } = useNextTranslation()

    return <p>{t('Hello World')}</p>
}
```

### With Variables

```tsx
const { t } = useNextTranslation()

// In your JSX
<p>{t("Welcome, {{username}}", { username: user.name })}</p>
```

## Adding New Translations

1. Create translation keys in the `/public/locales/{language}/common.json` files
2. Use the same English text as the key in your components
3. Add translations for each supported language

## Adding a New Language

1. Create a new folder in `/public/locales/{new-language-code}/`
2. Copy the `common.json` file from the `en` folder
3. Translate all the values in the new `common.json` file
4. Add the language code to the `locales` array in `next-i18next.config.js`

## Language Switcher

A language switcher component is available at `components/common/LanguageSwitcher.tsx`. This component allows users to switch between the available languages.

### Language Persistence

The application stores the user's language preference in localStorage and cookies with the key `comfy-registry-language-preference`. This ensures that:

1. The user's language preference persists across visits
2. The preferred language is automatically applied when the user returns to the site
3. The browser's language is only used for the initial visit if no preference is stored

### Server-Side Language Detection

The application also implements server-side language detection through Next.js middleware. This provides the following benefits:

1. **SEO-friendly**: Search engines can index content in the correct language
2. **No Flash of Wrong Language**: Users see content in their preferred language immediately without any flicker
3. **Consistent Experience**: Language detection works even if JavaScript is disabled

The server-side detection works by:

1. Checking for existing language preference in cookies
2. Reading the `Accept-Language` HTTP header if no cookie is present
3. Setting a cookie with the detected language
4. Passing the language preference to the client-side i18n setup

## Translation Files Structure

```
/public/locales/
  /en/
    common.json
  /zh/
    common.json
  /ja/
    common.json
```

## Best Practices

1. Always use the `t()` function for any text visible to users
2. Use the original English text as the translation key
3. Keep translation keys simple and meaningful
4. Use variables for dynamic content
5. Test the UI in all supported languages
